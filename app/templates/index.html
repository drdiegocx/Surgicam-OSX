<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
    />
    <title>Mini-DVR | Panel de control</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="/static/css/styles.css" />
  </head>
  <body
    class="workspace"
    data-preview-port="{{ preview_port }}"
    data-source-width="{{ source_width }}"
    data-source-height="{{ source_height }}"
    data-theme="nebula"
  >
    <main class="workspace-grid" role="application" aria-label="Panel de control de video">
      <section class="live-stage" aria-live="off">
        <div class="live-frame" id="previewFrame">
          <div class="preview-viewport" id="previewViewport">
            <img id="preview" src="" alt="Vista previa en vivo" class="preview-image" />
            <div class="preview-watermark" aria-hidden="true">SURGICAM</div>
          </div>
        </div>
      </section>

      <aside
        class="overlay-window overlay-status"
        data-window
        data-draggable
        data-window-id="status"
        aria-label="Estado del sistema"
      >
        <header class="window-header" data-drag-handle>
          <span class="window-title">Estado</span>
          <div class="window-actions">
            <button type="button" class="window-btn" data-window-collapse aria-label="Colapsar panel">
              <i class="bi bi-chevron-down" aria-hidden="true"></i>
            </button>
          </div>
        </header>
        <div class="window-body">
          <div class="status-grid">
            <div class="status-pill">
              <span class="status-label">Vista previa</span>
              <span id="previewState" class="status-value">-</span>
            </div>
            <div class="status-pill">
              <span class="status-label">Grabación</span>
              <span id="recordState" class="status-value">-</span>
            </div>
          </div>
          <p id="fileInfo" class="status-info"></p>
          <p id="alerts" class="status-alert"></p>
        </div>
      </aside>

      <aside
        class="overlay-window overlay-mini-map"
        data-window
        data-draggable
        data-window-id="navigator"
        aria-label="Navegación de zoom"
      >
        <header class="window-header" data-drag-handle>
          <span class="window-title">Navegador</span>
          <div class="window-actions">
            <button type="button" class="window-btn" data-window-collapse aria-label="Colapsar navegador">
              <i class="bi bi-chevron-down" aria-hidden="true"></i>
            </button>
          </div>
        </header>
        <div class="window-body">
          <div class="mini-map" id="roiMiniMap">
            <img id="roiMiniMapImg" src="" alt="Mapa de referencia" class="mini-map-image" />
            <div class="mini-map-indicator" id="roiIndicator" aria-hidden="true"></div>
          </div>
          <div class="mini-map-controls" id="roiControls">
            <div class="control-row">
              <span class="control-label">Zoom</span>
              <span class="control-value" id="zoomValue">1.0x</span>
            </div>
            <input
              type="range"
              class="control-range"
              id="zoomSlider"
              min="100"
              max="400"
              step="10"
              value="100"
              aria-label="Zoom digital"
            />
            <div class="pan-grid">
              <button type="button" data-pan="up" aria-label="Desplazar arriba">↑</button>
              <div class="pan-middle">
                <button type="button" data-pan="left" aria-label="Desplazar izquierda">←</button>
                <button type="button" data-pan="center" aria-label="Centrar">•</button>
                <button type="button" data-pan="right" aria-label="Desplazar derecha">→</button>
              </div>
              <button type="button" data-pan="down" aria-label="Desplazar abajo">↓</button>
            </div>
          </div>
        </div>
      </aside>

      <section class="overlay-window overlay-actions" data-window data-draggable data-window-id="actions">
        <header class="window-header" data-drag-handle>
          <span class="window-title">Acciones</span>
          <div class="window-actions">
            <button type="button" class="window-btn" data-window-collapse aria-label="Colapsar acciones">
              <i class="bi bi-chevron-down" aria-hidden="true"></i>
            </button>
          </div>
        </header>
        <div class="window-body">
          <div class="action-deck" role="group" aria-label="Acciones principales">
            <button id="startBtn" class="action-btn action-btn-primary" type="button">
              <i class="bi bi-record-circle" aria-hidden="true"></i>
              <span>Grabar</span>
            </button>
            <button id="stopBtn" class="action-btn" type="button" disabled>
              <i class="bi bi-stop-circle" aria-hidden="true"></i>
              <span>Detener</span>
            </button>
            <button id="snapshotBtn" class="action-btn" type="button">
              <i class="bi bi-camera" aria-hidden="true"></i>
              <span>Foto</span>
            </button>
            <button
              class="action-btn"
              type="button"
              data-bs-toggle="offcanvas"
              data-bs-target="#controlsDrawer"
              aria-controls="controlsDrawer"
            >
              <i class="bi bi-sliders" aria-hidden="true"></i>
              <span>Controles</span>
            </button>
          </div>
        </div>
      </section>

      <section class="overlay-window overlay-menu" data-window data-draggable data-window-id="menu">
        <header class="window-header" data-drag-handle>
          <span class="window-title">Panel</span>
          <div class="window-actions">
            <button type="button" class="window-btn" data-window-collapse aria-label="Colapsar panel">
              <i class="bi bi-chevron-down" aria-hidden="true"></i>
            </button>
          </div>
        </header>
        <div class="window-body">
          <div class="menu-grid">
            <div class="menu-section">
              <h2 class="menu-heading">Flujo</h2>
              <button type="button" class="menu-btn" data-command="open-gallery">
                <i class="bi bi-collection-play" aria-hidden="true"></i>
                <span>Galería</span>
              </button>
              <button type="button" class="menu-btn" data-command="open-controls">
                <i class="bi bi-sliders" aria-hidden="true"></i>
                <span>Control de cámara</span>
              </button>
            </div>
            <div class="menu-section">
              <h2 class="menu-heading">Temas</h2>
              <div class="theme-grid" role="group" aria-label="Selector de tema">
                <button type="button" class="theme-chip" data-command="set-theme" data-theme="nebula">Nebula</button>
                <button type="button" class="theme-chip" data-command="set-theme" data-theme="lumen">Lumen</button>
                <button type="button" class="theme-chip" data-command="set-theme" data-theme="verdant">Verdant</button>
              </div>
            </div>
            <div class="menu-section">
              <h2 class="menu-heading">Escala</h2>
              <div class="theme-grid" role="group" aria-label="Tamaño de vista">
                <button type="button" class="theme-chip" data-command="set-scale" data-scale="0.8">80%</button>
                <button type="button" class="theme-chip" data-command="set-scale" data-scale="0.9">90%</button>
                <button type="button" class="theme-chip" data-command="set-scale" data-scale="1">100%</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div id="controlsAlert" class="system-toast d-none" role="status"></div>

      <div class="command-palette" id="commandPalette" role="dialog" aria-modal="true" hidden>
        <div class="command-surface" data-draggable data-window-id="palette">
          <header class="command-header" data-drag-handle>
            <h2 class="command-title">Acciones rápidas</h2>
            <p class="command-hint">Pulsa Enter para abrir, Escape para cerrar.</p>
          </header>
          <ul class="command-list" data-command-list>
            <li><button type="button" data-command="start-recording">Iniciar grabación</button></li>
            <li><button type="button" data-command="stop-recording">Detener grabación</button></li>
            <li><button type="button" data-command="capture-photo">Capturar fotografía</button></li>
            <li><button type="button" data-command="open-controls">Ajustes de cámara</button></li>
            <li><button type="button" data-command="open-gallery">Abrir galería</button></li>
            <li><button type="button" data-command="set-scale" data-scale="1">Vista completa</button></li>
          </ul>
        </div>
      </div>
    </main>

    <div
      class="offcanvas offcanvas-end app-drawer text-bg-dark"
      tabindex="-1"
      id="controlsDrawer"
      aria-labelledby="controlsDrawerLabel"
      data-bs-backdrop="false"
      data-bs-scroll="true"
    >
      <div class="offcanvas-header border-bottom border-light-subtle">
        <h2 class="offcanvas-title h5 mb-0" id="controlsDrawerLabel">Controles de cámara</h2>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
      </div>
      <div class="offcanvas-body d-flex flex-column gap-3">
        <div id="controlsLoading" class="drawer-loading text-center text-muted py-3">
          <div class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></div>
          <span class="ms-2">Cargando controles...</span>
        </div>
        <div id="controlsContent" class="d-none d-flex flex-column flex-grow-1">
          <ul class="nav nav-tabs" id="controlsTabNav" role="tablist"></ul>
          <div class="tab-content flex-grow-1 overflow-auto border border-top-0 rounded-bottom" id="controlsTabContent"></div>
        </div>
      </div>
    </div>

    <div class="modal fade video-modal" id="videoModal" tabindex="-1" aria-labelledby="videoModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h2 class="modal-title h5 mb-0" id="videoModalLabel">Reproducción de video</h2>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <div class="ratio ratio-16x9 video-player-frame mb-3">
              <video id="videoPlayer" class="video-player" controls preload="metadata" playsinline></video>
            </div>
            <div class="d-flex flex-column flex-md-row gap-3 align-items-md-center justify-content-md-between">
              <p id="videoMeta" class="video-meta small text-muted mb-0 d-none"></p>
              <a id="videoDownload" class="btn btn-sm btn-outline-light d-none" href="#" download>Descargar video</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade gallery-modal" id="galleryModal" tabindex="-1" aria-labelledby="galleryModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-sm-down">
        <div class="modal-content">
          <div class="modal-header border-0 align-items-start">
            <div>
              <h2 class="modal-title h5 mb-1" id="galleryModalLabel">Galería de medios</h2>
              <p class="text-muted small mb-0">Consulta y gestiona las fotografías y grabaciones generadas desde el panel.</p>
            </div>
            <div class="d-flex align-items-center gap-2">
              <button id="refreshGalleryBtn" class="btn btn-sm btn-outline-light" type="button">
                <i class="bi bi-arrow-clockwise" aria-hidden="true"></i>
                <span>Actualizar</span>
              </button>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
          </div>
          <div class="modal-body">
            <div id="galleryEmpty" class="gallery-empty text-muted small py-2">
              No hay fotografías ni videos almacenados.
            </div>
            <div class="media-section mb-4">
              <div class="media-section-header d-flex align-items-center justify-content-between gap-2 mb-2">
                <h3 class="media-heading h6 mb-0">Fotografías</h3>
                <span id="photoSummary" class="media-summary text-muted small"></span>
              </div>
              <div id="photoGallery" class="media-grid"></div>
            </div>
            <div class="media-section mb-0">
              <div class="media-section-header d-flex align-items-center justify-content-between gap-2 mb-2">
                <h3 class="media-heading h6 mb-0">Videos</h3>
                <span id="videoSummary" class="media-summary text-muted small"></span>
              </div>
              <div id="videoGallery" class="media-grid"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script src="/static/js/app.js" defer></script>
  </body>
</html>
