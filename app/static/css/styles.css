:root {
  color-scheme: dark;
  --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --viewport-ratio: 16 / 9;
  --viewport-scale: 0.9;
  --space-1: 0.25rem;
  --space-2: 0.5rem;
  --space-3: 0.75rem;
  --space-4: 1rem;
  --space-5: 1.5rem;
  --space-6: 2rem;
  --radius-lg: clamp(1rem, 2vw, 2.5rem);
  --radius-md: 1rem;
  --radius-sm: 0.5rem;
  --transition-fast: 140ms ease;
  --transition-medium: 220ms ease;
  --shadow-window: 0 32px 60px rgba(2, 10, 25, 0.45);
  --shadow-floating: 0 18px 34px rgba(2, 10, 25, 0.35);
  --border-strong: rgba(255, 255, 255, 0.16);
  --border-soft: rgba(255, 255, 255, 0.08);
  --glass: rgba(10, 14, 22, 0.7);
  --glass-strong: rgba(10, 14, 22, 0.85);
  --surface: rgba(12, 18, 31, 0.8);
  --surface-muted: rgba(14, 22, 37, 0.7);
  --surface-highlight: rgba(40, 120, 255, 0.22);
  --accent: #38bdf8;
  --accent-strong: #0ea5e9;
  --accent-soft: rgba(56, 189, 248, 0.18);
  --danger: #f87171;
  --text-primary: #f5f6f8;
  --text-muted: rgba(245, 246, 248, 0.68);
  --viewport-bg: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), transparent 65%),
    radial-gradient(circle at bottom right, rgba(14, 165, 233, 0.16), transparent 55%), #030712;
}

body[data-theme='lumen'] {
  color-scheme: light;
  --glass: rgba(243, 246, 255, 0.75);
  --glass-strong: rgba(240, 244, 255, 0.9);
  --surface: rgba(245, 248, 255, 0.92);
  --surface-muted: rgba(235, 240, 255, 0.7);
  --surface-highlight: rgba(56, 130, 230, 0.2);
  --border-strong: rgba(0, 20, 60, 0.18);
  --border-soft: rgba(0, 20, 60, 0.08);
  --accent: #2563eb;
  --accent-strong: #1d4ed8;
  --accent-soft: rgba(37, 99, 235, 0.12);
  --text-primary: #081222;
  --text-muted: rgba(8, 18, 34, 0.7);
  --danger: #dc2626;
  --viewport-bg: radial-gradient(circle at top left, rgba(37, 99, 235, 0.12), transparent 60%),
    radial-gradient(circle at bottom, rgba(14, 116, 144, 0.12), transparent 55%), #f5f7ff;
  background: #e8edff;
}

body[data-theme='verdant'] {
  --glass: rgba(5, 24, 18, 0.7);
  --glass-strong: rgba(4, 20, 16, 0.82);
  --surface: rgba(6, 34, 24, 0.78);
  --surface-muted: rgba(6, 30, 22, 0.66);
  --surface-highlight: rgba(16, 185, 129, 0.22);
  --border-strong: rgba(16, 185, 129, 0.26);
  --border-soft: rgba(16, 185, 129, 0.12);
  --accent: #34d399;
  --accent-strong: #10b981;
  --accent-soft: rgba(52, 211, 153, 0.15);
  --text-primary: #ecfdf5;
  --text-muted: rgba(236, 253, 245, 0.7);
  --danger: #f87171;
  --viewport-bg: radial-gradient(circle at top, rgba(52, 211, 153, 0.18), transparent 55%),
    radial-gradient(circle at bottom right, rgba(16, 185, 129, 0.18), transparent 55%), #04130c;
  background: #021b11;
}

html,
body {
  height: 100%;
}

body {
  margin: 0;
  font-family: var(--font-family);
  color: var(--text-primary);
  background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), transparent 55%),
    radial-gradient(circle at bottom right, rgba(14, 165, 233, 0.12), transparent 55%), #060b16;
  overflow: hidden;
  min-height: 100dvh;
  display: flex;
}

.workspace-grid {
  display: grid;
  grid-template-columns: repeat(12, minmax(0, 1fr));
  grid-template-rows: repeat(12, minmax(0, 1fr));
  gap: var(--space-4);
  width: 100vw;
  height: 100dvh;
  padding: clamp(var(--space-4), 1.6vw + var(--space-2), var(--space-6));
  box-sizing: border-box;
  position: relative;
  isolation: isolate;
}

.live-stage {
  grid-area: 1 / 1 / -1 / -1;
  position: relative;
  z-index: 1;
  display: grid;
  place-items: center;
  pointer-events: none;
}

.live-frame {
  width: min(
    calc(var(--viewport-scale) * 100vw),
    calc(var(--viewport-scale) * 100vh * var(--viewport-ratio))
  );
  height: min(
    calc(var(--viewport-scale) * 100vh),
    calc(var(--viewport-scale) * 100vw / var(--viewport-ratio))
  );
  aspect-ratio: var(--viewport-ratio);
  border-radius: var(--radius-lg);
  overflow: hidden;
  background: var(--viewport-bg);
  box-shadow: var(--shadow-window);
  position: relative;
  pointer-events: auto;
  transition: width var(--transition-medium), height var(--transition-medium);
}

.preview-viewport,
.preview-image {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
}

.preview-image {
  object-fit: cover;
  background: #000;
  transform-origin: center;
  transition: transform var(--transition-fast);
}

.preview-watermark {
  position: absolute;
  top: clamp(var(--space-5), 2vw, 3rem);
  left: 50%;
  transform: translateX(-50%);
  font-weight: 700;
  letter-spacing: 0.65rem;
  font-size: clamp(1.25rem, 3vw, 2.5rem);
  text-transform: uppercase;
  color: rgba(245, 246, 248, 0.2);
  pointer-events: none;
}

.overlay-window {
  position: relative;
  z-index: var(--window-layer, 2);
  background: var(--glass);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-soft);
  box-shadow: var(--shadow-floating);
  backdrop-filter: blur(12px);
  display: flex;
  flex-direction: column;
  min-width: 220px;
  transform: translate3d(var(--window-x, 0px), var(--window-y, 0px), 0);
  transition: box-shadow var(--transition-fast), border-color var(--transition-fast);
}

.overlay-window.is-active {
  border-color: var(--border-strong);
  box-shadow: 0 20px 40px rgba(2, 8, 20, 0.5);
  --window-layer: 5;
}

.overlay-window.is-collapsed .window-body {
  display: none;
}

.overlay-window.is-collapsed .window-header {
  border-bottom: none;
}

.overlay-status {
  grid-area: 1 / 1 / span 3 / span 4;
}

.overlay-menu {
  grid-area: 2 / 9 / span 4 / span 4;
}

.overlay-mini-map {
  grid-area: 8 / 1 / span 4 / span 3;
}

.overlay-actions {
  grid-area: 9 / 4 / span 4 / span 6;
  justify-self: center;
}

.window-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-3);
  padding: var(--space-3) var(--space-4);
  cursor: grab;
  border-bottom: 1px solid var(--border-soft);
}

.overlay-window.is-collapsed .window-header {
  cursor: pointer;
}

.window-title {
  font-size: 0.85rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--text-muted);
}

.window-actions {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.window-btn {
  appearance: none;
  border: none;
  background: transparent;
  color: var(--text-muted);
  padding: var(--space-1);
  border-radius: var(--radius-sm);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: color var(--transition-fast), background var(--transition-fast);
}

.window-btn:hover,
.window-btn:focus-visible {
  color: var(--text-primary);
  background: var(--surface-highlight);
  outline: none;
}

.window-body {
  padding: var(--space-4);
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
}

.status-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: var(--space-3);
}

.status-pill {
  display: flex;
  flex-direction: column;
  gap: calc(var(--space-2) / 2);
  background: var(--surface-muted);
  border-radius: var(--radius-sm);
  padding: var(--space-3);
  border: 1px solid var(--border-soft);
}

.status-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--text-muted);
}

.status-value {
  font-weight: 600;
  font-size: 1rem;
}

.status-info,
.status-alert {
  margin: 0;
  font-size: 0.8rem;
  color: var(--text-muted);
}

.status-alert {
  color: var(--accent);
}

.mini-map {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 9;
  border-radius: var(--radius-sm);
  overflow: hidden;
  border: 1px solid var(--border-soft);
  background: rgba(3, 7, 18, 0.9);
}

.mini-map-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.mini-map-indicator {
  position: absolute;
  border: 2px solid var(--accent);
  border-radius: 0.3rem;
  box-shadow: 0 0 0 2px rgba(3, 7, 18, 0.6);
  pointer-events: none;
}

.mini-map-controls {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.control-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 0.85rem;
  color: var(--text-muted);
}

.control-range {
  width: 100%;
  accent-color: var(--accent);
}

.pan-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  justify-items: center;
  gap: var(--space-2);
}

.pan-middle {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: var(--space-2);
}

.pan-grid button {
  appearance: none;
  border: 1px solid var(--border-soft);
  background: var(--surface-muted);
  color: var(--text-primary);
  border-radius: var(--radius-sm);
  padding: var(--space-2);
  font-size: 0.85rem;
  transition: background var(--transition-fast), border-color var(--transition-fast);
}

.pan-grid button:hover,
.pan-grid button:focus-visible {
  outline: none;
  border-color: var(--accent);
  background: var(--accent-soft);
}

.action-deck {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: var(--space-3);
}

.action-btn {
  appearance: none;
  border: 1px solid var(--border-soft);
  background: var(--surface-muted);
  color: var(--text-primary);
  border-radius: var(--radius-sm);
  padding: var(--space-3);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
  font-size: 0.9rem;
  transition: transform var(--transition-fast), border-color var(--transition-fast),
    background var(--transition-fast);
}

.action-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.action-btn:hover:not(:disabled),
.action-btn:focus-visible:not(:disabled) {
  outline: none;
  border-color: var(--accent);
  background: var(--accent-soft);
  transform: translateY(-1px);
}

.action-btn-primary {
  background: var(--accent);
  border-color: var(--accent-strong);
  color: #030712;
}

.menu-grid {
  display: grid;
  gap: var(--space-4);
}

.menu-section {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.menu-heading {
  margin: 0;
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--text-muted);
}

.menu-btn {
  appearance: none;
  border: 1px solid var(--border-soft);
  background: var(--surface-muted);
  color: var(--text-primary);
  border-radius: var(--radius-sm);
  padding: var(--space-3);
  display: flex;
  align-items: center;
  gap: var(--space-3);
  font-size: 0.9rem;
  transition: background var(--transition-fast), border-color var(--transition-fast);
}

.menu-btn:hover,
.menu-btn:focus-visible {
  outline: none;
  border-color: var(--accent);
  background: var(--accent-soft);
}

.theme-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
  gap: var(--space-2);
}

.theme-chip {
  appearance: none;
  border: 1px solid var(--border-soft);
  border-radius: 999px;
  padding: var(--space-2) var(--space-3);
  font-size: 0.8rem;
  background: transparent;
  color: var(--text-primary);
  transition: background var(--transition-fast), border-color var(--transition-fast);
}

.theme-chip.is-active,
.theme-chip:hover,
.theme-chip:focus-visible {
  outline: none;
  border-color: var(--accent);
  background: var(--accent-soft);
}

.system-toast {
  grid-area: 2 / 5 / span 1 / span 4;
  justify-self: center;
  align-self: start;
  background: var(--surface-highlight);
  color: var(--text-primary);
  border-radius: var(--radius-sm);
  padding: var(--space-3) var(--space-4);
  border: 1px solid var(--border-soft);
  box-shadow: var(--shadow-floating);
}

.command-palette {
  position: absolute;
  inset: 0;
  background: rgba(2, 6, 14, 0.55);
  backdrop-filter: blur(18px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: clamp(1rem, 4vw, 4rem);
  z-index: 10;
}

.command-palette[hidden] {
  display: none;
}

.command-surface {
  background: var(--glass-strong);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-strong);
  width: min(480px, 90vw);
  max-height: min(70vh, 520px);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  box-shadow: var(--shadow-window);
  transform: translate3d(var(--window-x, 0px), var(--window-y, 0px), 0);
}

.command-header {
  padding: var(--space-4);
  border-bottom: 1px solid var(--border-soft);
  cursor: grab;
}

.command-title {
  margin: 0 0 var(--space-2) 0;
  font-size: 1.1rem;
}

.command-hint {
  margin: 0;
  font-size: 0.8rem;
  color: var(--text-muted);
}

.command-list {
  list-style: none;
  margin: 0;
  padding: var(--space-2);
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  overflow: auto;
}

.command-list button {
  width: 100%;
  appearance: none;
  border: none;
  border-radius: var(--radius-sm);
  padding: var(--space-3) var(--space-4);
  text-align: left;
  background: transparent;
  color: var(--text-primary);
  transition: background var(--transition-fast);
}

.command-list button:hover,
.command-list button:focus-visible {
  outline: none;
  background: var(--surface-highlight);
}

.action-btn.is-busy::after {
  content: '…';
  margin-left: var(--space-1);
}

.video-modal .modal-content,
.gallery-modal .modal-content,
.app-drawer {
  background: var(--glass-strong);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-soft);
  backdrop-filter: blur(12px);
  color: var(--text-primary);
}

.gallery-modal .modal-header,
.video-modal .modal-header,
.app-drawer .offcanvas-header {
  border-color: var(--border-soft) !important;
}

.media-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 1rem;
}

.media-item {
  background: var(--surface-muted);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-soft);
}

@media (max-width: 1024px) {
  :root {
    --viewport-scale: 0.9;
  }

  .workspace-grid {
    gap: var(--space-3);
    padding: var(--space-4);
  }

  .overlay-menu {
    grid-area: 1 / 8 / span 4 / span 5;
  }

  .overlay-actions {
    grid-area: 9 / 3 / span 4 / span 7;
  }
}

@media (max-width: 768px) {
  :root {
    --viewport-scale: 0.88;
  }

  .workspace-grid {
    padding: var(--space-3);
  }

  .overlay-window {
    min-width: 200px;
  }

  .overlay-menu,
  .overlay-actions,
  .overlay-mini-map,
  .overlay-status {
    grid-area: auto / auto / span 3 / span 6;
    justify-self: stretch;
  }

  .overlay-window {
    transform: translate3d(0, 0, 0);
  }
}

@media (max-width: 600px) {
  :root {
    --viewport-scale: 0.86;
  }

  .window-body {
    padding: var(--space-3);
  }

  .action-deck {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}
